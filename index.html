<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="" />
  <title>1.2 base</title>
  <link rel="stylesheet" href="codered.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <style>

  </style>
</head>
<body>
  <canvas id="background-canvas"></canvas>

  <!-- Loading screen and landing -->
  <div class="LoadingScreen">
    <div class="spinner">
      <div></div><div></div><div></div><div></div><div></div>
      <div></div><div></div><div></div><div></div><div></div>
    </div>
  </div>
  <div class="landing">
    <div class="landing-content">
      <div class="landing-content-inner">"Code Red"</div>
      <div class="landing-content-sub">Soviet Russia, 1976</div>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="navbar">
    <ul class="nav-links">
      <li><a href="index.html" onclick="return !isCurrentPage('index.html')">Landing</a></li>
      <li><a href="trailer.html" onclick="return !isCurrentPage('trailer.html')">Trailer</a></li>
      <li><a href="aboutus.html" onclick="return !isCurrentPage('aboutus.html')">About</a></li>
      <li><a href="pricing.html" onclick="return !isCurrentPage('pricing.html')">Pricing</a></li>
      <li><a href="gallery.html" onclick="return showExplicitWarning(event)" aria-label="Gallery (Content Warning)">Gallery</a></li>
    </ul>
  </nav>

<!-- Simplified Explicit Content Warning -->
<div id="blur-overlay" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); z-index: 9998; display: none;"></div>

<div id="explicit-warning" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 2rem; border: 2px solid black; z-index: 9999; display: none;" role="alertdialog" aria-labelledby="warning-title" aria-describedby="warning-desc" aria-hidden="true">

  <h2 id="warning-title">Content Warning</h2>
  <p id="warning-desc">This gallery contains content some users may find disturbing or explicit. (R-15)</p>

  <!-- Plain buttons -->
  <div style="margin-top: 1rem;">
    <button onclick="proceedToGallery()">I Understand, Proceed</button>
    <button onclick="stayOnLanding()">Take Me Back</button>
  </div>
</div>


<!-- Floating Soviet-style Icon Menu -->
<div class="floating-container" aria-label="Accessibility and contact menu" role="navigation">
  <div class="floating-button" aria-expanded="false" aria-controls="floatingMenu" aria-label="Toggle menu">+</div>
  <div class="element-container" id="floatingMenu">
    <!-- Removed phone and email buttons -->
    <a href="form.html" title="Chat" aria-label="Chat"><span class="float-element"><i class="material-icons">chat</i></span></a>
    <button class="float-element" onclick="toggleHighContrastMode()" title="Toggle High Contrast Mode" aria-pressed="false" id="highContrastToggle" aria-label="Toggle High Contrast Mode">
      <i class="material-icons">invert_colors</i>
    </button>
    <button class="float-element" onclick="toggleExtraReadableFont()" title="Toggle Extra Readable Font" aria-pressed="false" id="readableFontToggle" aria-label="Toggle Extra Readable Font">
      <i class="material-icons">format_size</i>
    </button>

  </div>
</div>


  <script>
    // Wrap letters with flicker and float animation
    function wrapLetters(selector, delayIncrement = 0.3) {
      const el = document.querySelector(selector);
      if (!el) return;
      const text = el.textContent;
      el.innerHTML = '';
      [...text].forEach((char, index) => {
        const span = document.createElement('span');
        span.textContent = char;
        if (char === ' ') span.classList.add('space');
        const floatDelay = (index * delayIncrement).toFixed(2);
        span.style.animation = `flicker 3s infinite ease-in-out 0s, floatSingle 4.5s infinite cubic-bezier(0.4, 0, 0.2, 1) ${floatDelay}s`;
        el.appendChild(span);
      });
    }

    wrapLetters('.landing-content-inner');
    wrapLetters('.landing-content-sub');

    // Page and loading screen logic
    const currentPage = window.location.pathname.split('/').pop();
    const loadingScreen = document.querySelector('.LoadingScreen');
    if (document.referrer === '' || !document.referrer.includes(currentPage)) {
      loadingScreen.style.display = 'flex';
    } else {
      loadingScreen.style.display = 'none';
    }
    window.addEventListener('load', () => {
      if (loadingScreen.style.display === 'flex') {
        setTimeout(() => {
          loadingScreen.style.opacity = '0';
          setTimeout(() => {
            loadingScreen.style.display = 'none';
          }, 1000);
        }, 2000);
      }
    });
    setTimeout(() => {
      if (loadingScreen.style.display === 'flex') {
        loadingScreen.style.opacity = '0';
        setTimeout(() => {
          loadingScreen.style.display = 'none';
        }, 1000);
      }
    }, 5000);

    function isCurrentPage(href) {
      return window.location.pathname.endsWith(href);
    }

    // Explicit content warning functions
    function showExplicitWarning(event) {
      event.preventDefault();
      const warning = document.getElementById('explicit-warning');
      const overlay = document.getElementById('blur-overlay');
      warning.style.display = 'block';
      overlay.style.display = 'block';
      warning.setAttribute('aria-hidden', 'false');
      overlay.setAttribute('aria-hidden', 'false');
      
      // Trap focus within the warning dialog
      const focusableElements = warning.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      const firstFocusableElement = focusableElements[0];
      const lastFocusableElement = focusableElements[focusableElements.length - 1];
      
      // Focus the first button
      firstFocusableElement.focus();
      
      // Handle keyboard navigation
      function handleTab(e) {
        if (e.key === 'Tab') {
          if (e.shiftKey) {
            if (document.activeElement === firstFocusableElement) {
              e.preventDefault();
              lastFocusableElement.focus();
            }
          } else {
            if (document.activeElement === lastFocusableElement) {
              e.preventDefault();
              firstFocusableElement.focus();
            }
          }
        }
        if (e.key === 'Escape') {
          stayOnLanding();
        }
      }
      
      warning.addEventListener('keydown', handleTab);
      return false;
    }

    function proceedToGallery() {
      const hasAccepted = localStorage.getItem('galleryWarningAccepted');
      if (!hasAccepted) {
        localStorage.setItem('galleryWarningAccepted', 'true');
      }
      window.location.href = 'gallery.html';
    }

    function stayOnLanding() {
      const warning = document.getElementById('explicit-warning');
      const overlay = document.getElementById('blur-overlay');
      warning.style.display = 'none';
      overlay.style.display = 'none';
      warning.setAttribute('aria-hidden', 'true');
      overlay.setAttribute('aria-hidden', 'true');
    }

    // Check if user has already accepted the warning
    document.addEventListener('DOMContentLoaded', () => {
      const currentPage = window.location.pathname.split('/').pop();
      const hasAccepted = localStorage.getItem('galleryWarningAccepted');
      if (currentPage === 'gallery.html' && !hasAccepted) {
        showExplicitWarning({ preventDefault: () => {} });
      }
    });

    // Accessibility toggles with persistence
    const highContrastCheckbox = document.getElementById('highContrastMode');
    const readableFontCheckbox = document.getElementById('extraReadableFont');

    function toggleHighContrastMode() {
      const isActive = document.body.classList.toggle('high-contrast-mode');
      if(highContrastCheckbox) highContrastCheckbox.checked = isActive;
      localStorage.setItem('highContrastMode', isActive);
      // Also update toggle button aria-pressed if exists
      const btn = document.getElementById('highContrastToggle');
      if(btn) btn.setAttribute('aria-pressed', isActive);
    }

    function toggleExtraReadableFont() {
      const isActive = document.body.classList.toggle('extra-readable-font');
      if(readableFontCheckbox) readableFontCheckbox.checked = isActive;
      localStorage.setItem('extraReadableFont', isActive);
      const btn = document.getElementById('readableFontToggle');
      if(btn) btn.setAttribute('aria-pressed', isActive);
    }

    if(highContrastCheckbox) highContrastCheckbox.addEventListener('change', toggleHighContrastMode);
    if(readableFontCheckbox) readableFontCheckbox.addEventListener('change', toggleExtraReadableFont);

    // Load persisted accessibility preferences on DOM ready
    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('highContrastMode') === 'true') {
        document.body.classList.add('high-contrast-mode');
        if(highContrastCheckbox) highContrastCheckbox.checked = true;
        const btn = document.getElementById('highContrastToggle');
        if(btn) btn.setAttribute('aria-pressed', true);
      }
      if (localStorage.getItem('extraReadableFont') === 'true') {
        document.body.classList.add('extra-readable-font');
        if(readableFontCheckbox) readableFontCheckbox.checked = true;
        const btn = document.getElementById('readableFontToggle');
        if(btn) btn.setAttribute('aria-pressed', true);
      }
    });

    // Floating menu toggle logic
    const floatingButton = document.querySelector('.floating-button');
    const floatingMenu = document.getElementById('floatingMenu');

    floatingButton.addEventListener('click', (e) => {
      e.stopPropagation(); // Prevent event bubbling
      const isShown = floatingMenu.classList.toggle('show');
      floatingButton.setAttribute('aria-expanded', isShown);
    });

    // Close floating menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!floatingMenu.contains(e.target) && !floatingButton.contains(e.target)) {
        floatingMenu.classList.remove('show');
        floatingButton.setAttribute('aria-expanded', 'false');
      }
    });
  </script>
</body>
</html>
