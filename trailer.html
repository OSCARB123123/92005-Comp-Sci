<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Trailer Page</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="codered.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
  <!-- Explicit Content Warning -->
  <div id="blur-overlay" class="blur-overlay" role="dialog" aria-hidden="true"></div>
  <div id="explicit-warning" class="explicit-popup" role="alertdialog" aria-labelledby="warning-title" aria-describedby="warning-desc">
    <h2 id="warning-title" class="sr-only">Content Warning</h2>
    <p id="warning-desc">This gallery contains content some users may find disturbing or explicit. (R-15)</p>
    <div class="popup-buttons">
      <button onclick="proceedToGallery()" aria-label="Proceed to gallery">I Understand, Proceed</button>
      <button onclick="stayOnLanding()" aria-label="Return to current page">Take Me Back</button>
    </div>
  </div>

  <!-- Floating Soviet-style Icon Menu -->
  <div class="floating-container" aria-label="Accessibility and contact menu" role="navigation">
    <div class="floating-button" aria-expanded="false" aria-controls="floatingMenu" aria-label="Toggle menu">+</div>
    <div class="element-container" id="floatingMenu">
      <a href="form.html" title="Chat" aria-label="Chat"><span class="float-element"><i class="material-icons">chat</i></span></a>
      <button class="float-element" onclick="toggleHighContrastMode()" title="Toggle High Contrast Mode" aria-pressed="false" id="highContrastToggle" aria-label="Toggle High Contrast Mode">
        <i class="material-icons">invert_colors</i>
      </button>
      <button class="float-element" onclick="toggleExtraReadableFont()" title="Toggle Extra Readable Font" aria-pressed="false" id="readableFontToggle" aria-label="Toggle Extra Readable Font">
        <i class="material-icons">format_size</i>
      </button>
    </div>
  </div>

  <!-- Loading Screen -->
  <div class="LoadingScreen">
    <div class="spinner">
      <div></div><div></div><div></div><div></div><div></div>
      <div></div><div></div><div></div><div></div><div></div>
    </div>
  </div>

  <!-- Trailer Content -->
  <div class="trailer">
    <div class="trailer-extras"></div>
    <div class="landing-content">
      <div class="trailer-content-inner">"Code Red"</div>
      <div class="trailer-video">
        <iframe width="560" height="315"
                src="https://www.youtube.com"
                title="YouTube video player"
                style="border: none;"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen>
        </iframe>
      </div>
      <div class="trailer-content-sub">Set in a place trapped in time since the 70's, "Code Red" follows the story of a blood stained recovery centre. It paints a picture of desperation and hope, exploring the human condition in the face of adversity.</div>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="navbar">
    <ul class="nav-links">
      <li><a href="index.html" onclick="return !isCurrentPage('index.html')">Landing</a></li>
      <li><a href="trailer.html" onclick="return !isCurrentPage('trailer.html')">Trailer</a></li>
      <li><a href="aboutus.html" onclick="return !isCurrentPage('aboutus.html')">About</a></li>
      <li><a href="pricing.html" onclick="return !isCurrentPage('pricing.html')">Pricing</a></li>
      <li><a href="gallery.html" onclick="return showExplicitWarning(event)" aria-label="Gallery (Content Warning)">Gallery</a></li>
    </ul>
  </nav>

  <script>
    function wrapLetters(selector, delayIncrement = 0.3) {
      const el = document.querySelector(selector);
      if (!el) return;
      const text = el.textContent;
      el.innerHTML = '';
      [...text].forEach((char, index) => {
        const span = document.createElement('span');
        span.textContent = char;
        if (char === ' ') span.classList.add('space');
        const floatDelay = (index * delayIncrement).toFixed(2);
        span.style.animation = `flicker 3s infinite ease-in-out 0s, floatSingle 4.5s infinite cubic-bezier(0.4, 0, 0.2, 1) ${floatDelay}s`;
        el.appendChild(span);
      });
    }

    wrapLetters('.trailer-content-inner');
    wrapLetters('.trailer-content-sub');

    // Explicit content warning functions
    function showExplicitWarning(event) {
      event.preventDefault();
      const warning = document.getElementById('explicit-warning');
      const overlay = document.getElementById('blur-overlay');
      warning.style.display = 'block';
      overlay.style.display = 'block';
      warning.setAttribute('aria-hidden', 'false');
      overlay.setAttribute('aria-hidden', 'false');
      
      // Trap focus within the warning dialog
      const focusableElements = warning.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      const firstFocusableElement = focusableElements[0];
      const lastFocusableElement = focusableElements[focusableElements.length - 1];
      
      // Focus the first button
      firstFocusableElement.focus();
      
      // Handle keyboard navigation
      function handleTab(e) {
        if (e.key === 'Tab') {
          if (e.shiftKey) {
            if (document.activeElement === firstFocusableElement) {
              e.preventDefault();
              lastFocusableElement.focus();
            }
          } else {
            if (document.activeElement === lastFocusableElement) {
              e.preventDefault();
              firstFocusableElement.focus();
            }
          }
        }
        if (e.key === 'Escape') {
          stayOnLanding();
        }
      }
      
      warning.addEventListener('keydown', handleTab);
      return false;
    }

    function proceedToGallery() {
      const hasAccepted = localStorage.getItem('galleryWarningAccepted');
      if (!hasAccepted) {
        localStorage.setItem('galleryWarningAccepted', 'true');
      }
      window.location.href = 'gallery.html';
    }

    function stayOnLanding() {
      document.getElementById('explicit-warning').style.display = 'none';
      document.getElementById('blur-overlay').style.display = 'none';
    }

    function isCurrentPage(href) {
      return window.location.pathname.endsWith(href);
    }

    const currentPage = window.location.pathname.split('/').pop();
    const loadingScreen = document.querySelector('.LoadingScreen');

    if (document.referrer === '' || !document.referrer.includes(currentPage)) {
      loadingScreen.style.display = 'flex';
    } else {
      loadingScreen.style.display = 'none';
    }

    window.addEventListener('load', () => {
      if (loadingScreen.style.display === 'flex') {
        setTimeout(() => {
          loadingScreen.style.opacity = '0';
          setTimeout(() => {
            loadingScreen.style.display = 'none';
          }, 1000);
        }, 2000);
      }

      // Slide down navbar
      document.querySelector('.navbar').classList.add('slide-down');
    });

    setTimeout(() => {
      if (loadingScreen.style.display === 'flex') {
        loadingScreen.style.opacity = '0';
        setTimeout(() => {
          loadingScreen.style.display = 'none';
        }, 1000);
      }
    }, 5000);

    function showExplicitWarning(event) {
      event.preventDefault();
      const warning = document.getElementById('explicit-warning');
      const overlay = document.getElementById('blur-overlay');
      warning.style.display = 'block';
      overlay.style.display = 'block';
      warning.setAttribute('aria-hidden', 'false');
      overlay.setAttribute('aria-hidden', 'false');
      return false;
    }

    function proceedToGallery() {
      window.location.href = 'gallery.html';
    }

    function stayOnLanding() {
      const warning = document.getElementById('explicit-warning');
      const overlay = document.getElementById('blur-overlay');
      warning.style.display = 'none';
      overlay.style.display = 'none';
      warning.setAttribute('aria-hidden', 'true');
      overlay.setAttribute('aria-hidden', 'true');
    }

    const highContrastCheckbox = document.getElementById('highContrastMode');
    const readableFontCheckbox = document.getElementById('extraReadableFont');

    function toggleHighContrastMode() {
      const isActive = document.body.classList.toggle('high-contrast-mode');
      if (highContrastCheckbox) highContrastCheckbox.checked = isActive;
      localStorage.setItem('highContrastMode', isActive);
      const btn = document.getElementById('highContrastToggle');
      if (btn) btn.setAttribute('aria-pressed', isActive);
    }

    function toggleExtraReadableFont() {
      const isActive = document.body.classList.toggle('extra-readable-font');
      if (readableFontCheckbox) readableFontCheckbox.checked = isActive;
      localStorage.setItem('extraReadableFont', isActive);
      const btn = document.getElementById('readableFontToggle');
      if (btn) btn.setAttribute('aria-pressed', isActive);
    }

    if (highContrastCheckbox) highContrastCheckbox.addEventListener('change', toggleHighContrastMode);
    if (readableFontCheckbox) readableFontCheckbox.addEventListener('change', toggleExtraReadableFont);

    document.addEventListener('DOMContentLoaded', () => {
      if (localStorage.getItem('highContrastMode') === 'true') {
        document.body.classList.add('high-contrast-mode');
        if (highContrastCheckbox) highContrastCheckbox.checked = true;
        const btn = document.getElementById('highContrastToggle');
        if (btn) btn.setAttribute('aria-pressed', true);
      }
      if (localStorage.getItem('extraReadableFont') === 'true') {
        document.body.classList.add('extra-readable-font');
        if (readableFontCheckbox) readableFontCheckbox.checked = true;
        const btn = document.getElementById('readableFontToggle');
        if (btn) btn.setAttribute('aria-pressed', true);
      }
    });

    const floatingButton = document.querySelector('.floating-button');
    const floatingMenu = document.getElementById('floatingMenu');

    floatingButton.addEventListener('click', (e) => {
      e.stopPropagation();
      const isShown = floatingMenu.classList.toggle('show');
      floatingButton.setAttribute('aria-expanded', isShown);
    });

    document.addEventListener('click', (e) => {
      if (!floatingMenu.contains(e.target) && !floatingButton.contains(e.target)) {
        floatingMenu.classList.remove('show');
        floatingButton.setAttribute('aria-expanded', 'false');
      }
    });
  </script>

  <canvas id="background-canvas"></canvas>
  <script>
    const canvas = document.getElementById('background-canvas');
    const ctx = canvas.getContext('2d');
    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
    canvas.style.position = 'fixed';
    canvas.style.top = 0;
    canvas.style.left = 0;
    canvas.style.zIndex = '1';
    canvas.style.width = '100vw';
    canvas.style.height = '100vh';
    canvas.style.pointerEvents = 'none';

    const particles = [];
    const particleCount = 60;
    for (let i = 0; i < particleCount; i++) {
      particles.push({
        x: Math.random() * width,
        y: Math.random() * height,
        r: 1 + Math.random() * 2,
        dx: -0.5 + Math.random(),
        dy: -0.5 + Math.random(),
        alpha: 0.1 + Math.random() * 0.3
      });
    }
    function animate() {
      ctx.clearRect(0, 0, width, height);
      for (let p of particles) {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
        ctx.fillStyle = `rgba(166, 136, 109, ${p.alpha})`;
        ctx.shadowColor = '#A6886D';
        ctx.shadowBlur = 8;
        ctx.fill();
        p.x += p.dx;
        p.y += p.dy;
        if (p.x < 0 || p.x > width) p.dx *= -1;
        if (p.y < 0 || p.y > height) p.dy *= -1;
      }
      requestAnimationFrame(animate);
    }
    animate();

    window.addEventListener('resize', () => {
      width = window.innerWidth;
      height = window.innerHeight;
      canvas.width = width;
      canvas.height = height;
    });
  </script>
</body>
</html>
