<!DOCTYPE html>
<html>
<head>
    <!-- Sets up how the browser reads the page -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title> Trailler page </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Links to the external stylesheet for design -->
    <link rel="stylesheet" href="codered.css">
</head>

<body>
    <!-- Button to open the accessibility menu -->
    <button class="accessibility-menu" onclick="toggleAccessibilityMenu()">Menu</button>
    
    <!-- Accessibility options for people who need visual help -->
    <div class="accessibility-menu-content" id="accessibilityMenu">
        <h2>Accessibility Menu</h2>
        <hr style="background-color: #A6886D; height: 2px; border: none;">

        <!-- Checkbox to turn on High Contrast Mode -->
        <label>
            <input type="checkbox" id="highContrastMode" onchange="toggleHighContrastMode()">
            High Contrast Mode
        </label>

        <!-- Checkbox to turn on easier-to-read fonts -->
        <label>
            <input type="checkbox" id="extraReadableFont" onchange="toggleExtraReadableFont()">
            Extra Readable Font
        </label>

        <br><br>

        <!-- Button to go to the feedback form page -->
        <h2>Contact / Feedback Form</h2>
        <hr style="background-color: #A6886D; height: 2px; border: none;">
        <button class="button" onclick="window.location.href='form.html'">
            <span>Form</span>
        </button>
    </div>

    <!-- Shows a loading screen when the page first loads -->
    <div class="LoadingScreen">
        <div class="spinner">
            <!-- Spinner animation made with 10 dots -->
            <div></div><div></div><div></div><div></div><div></div>
            <div></div><div></div><div></div><div></div><div></div>
        </div>
    </div>

    <!-- Main content of the trailer page -->
    <div class="trailer">
        <div class="trailer-extras"></div>
        <div class="landing-content">
            <!-- Game title -->
            <div class="trailer-content-inner">"Code Red"</div>

            <!-- YouTube video embedded into the page -->
            <div class="trailer-video">
                <iframe width="560" height="315"
                    src="https://www.youtube.com/watch?v=UoYMK1olf4s"
                    title="YouTube video player"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen>
                </iframe>
            </div>

            <!-- Description of the game/story -->
            <div class="trailer-content-sub">
                Set in a place trapped in time since the 70's, "Code Red" follows the story of a blood stained recovery centre. 
                It paints a picture of desperation and hope, exploring the human condition in the face of adversity.
            </div>
        </div>
    </div>

    <!-- Main navigation bar to go between different pages -->
    <nav class="navbar">
        <ul class="nav-links">
            <li><a href="index.html" onclick="return !isCurrentPage('index.html')">Landing</a></li>
            <li><a href="trailer.html" onclick="return !isCurrentPage('trailer.html')">Trailer</a></li>
            <li><a href="aboutus.html" onclick="return !isCurrentPage('aboutus.html')">About</a></li>
            <li><a href="pricing.html" onclick="return !isCurrentPage('pricing.html')">Pricing</a></li>
            <li><a href="gallery.html" onclick="return !isCurrentPage('gallery.html')">Gallery</a></li>
        </ul>
    </nav>

    <script>
        // Animates each letter of the title/subtitle to float and flicker
        function wrapLetters(selector, delayIncrement = 0.3) {
            const el = document.querySelector(selector);
            if (!el) return;
            const text = el.textContent;
            el.innerHTML = '';
            [...text].forEach((char, index) => {
                const span = document.createElement('span');
                span.textContent = char;
                if (char === ' ') span.classList.add('space');
                const floatDelay = (index * delayIncrement).toFixed(2);
                span.style.animation = `flicker 3s infinite ease-in-out 0s, floatSingle 4.5s infinite cubic-bezier(0.4, 0, 0.2, 1) ${floatDelay}s`;
                el.appendChild(span);
            });
        }

        // Apply letter animation to heading and description
        wrapLetters('.trailer-content-inner');
        wrapLetters('.trailer-content-sub');

        // Checks what page you're currently on
        function isCurrentPage(href) {
            return window.location.pathname.endsWith(href);
        }

        // Set up for the loading screen
        const currentPage = window.location.pathname.split('/').pop();
        const loadingScreen = document.querySelector('.LoadingScreen');

        // Show the loading screen only when changing pages
        if (document.referrer === '' || !document.referrer.includes(currentPage)) {
            loadingScreen.style.display = 'flex';
        } else {
            loadingScreen.style.display = 'none';
        }

        // Hide the loading screen after page fully loads
        window.addEventListener('load', () => {
            if (loadingScreen.style.display === 'flex') {
                setTimeout(() => {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 1000);
                }, 2000); // 2 second delay
            }
        });

        // Fallback: Hide loading screen if loading fails or takes too long
        setTimeout(() => {
            if (loadingScreen.style.display === 'flex') {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 1000);
            }
        }, 5000);

        // Function to open/close the accessibility menu
        function toggleAccessibilityMenu() {
            const menu = document.getElementById('accessibilityMenu');
            menu.classList.toggle('show');
        }

        // Close accessibility menu when clicking outside of it
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('accessibilityMenu');
            const button = document.querySelector('.accessibility-menu');
            if (!menu.contains(event.target) && !button.contains(event.target)) {
                menu.classList.remove('show');
            }
        });

        // Makes fonts easier to read if checkbox is ticked
        function toggleExtraReadableFont() {
            const checkbox = document.getElementById('extraReadableFont');
            const body = document.body;

            if (checkbox.checked) {
                body.classList.add('extra-readable-font');
                localStorage.setItem('extraReadableFont', 'true');
            } else {
                body.classList.remove('extra-readable-font');
                localStorage.setItem('extraReadableFont', 'false');
            }
        }

        // Turns high contrast mode on/off
        function toggleHighContrastMode() {
            const checkbox = document.getElementById('highContrastMode');
            const body = document.body;

            if (checkbox.checked) {
                body.classList.add('high-contrast-mode');
                localStorage.setItem('highContrastMode', 'true');
            } else {
                body.classList.remove('high-contrast-mode');
                localStorage.setItem('highContrastMode', 'false');
            }
        }

        // When the page finishes loading, apply saved accessibility settings
        document.addEventListener('DOMContentLoaded', () => {
            const savedFont = localStorage.getItem('extraReadableFont');
            if (savedFont === 'true') {
                document.body.classList.add('extra-readable-font');
                document.getElementById('extraReadableFont').checked = true;
            }

            const savedContrast = localStorage.getItem('highContrastMode');
            if (savedContrast === 'true') {
                document.body.classList.add('high-contrast-mode');
                document.getElementById('highContrastMode').checked = true;
            }
        });
    </script>

    <!-- Background canvas for floating particles animation -->
    <canvas id="background-canvas"></canvas>

    <script>
        // Sets up a moving particle background effect using canvas
        const canvas = document.getElementById('background-canvas');
        const ctx = canvas.getContext('2d');
        let width = window.innerWidth;
        let height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;

        // Makes canvas stay fixed behind the content
        canvas.style.position = 'fixed';
        canvas.style.top = 0;
        canvas.style.left = 0;
        canvas.style.zIndex = '1';
        canvas.style.width = '100vw';
        canvas.style.height = '100vh';
        canvas.style.pointerEvents = 'none';

        // Create particle objects
        const particles = [];
        const particleCount = 60;
        for (let i = 0; i < particleCount; i++) {
            particles.push({
                x: Math.random() * width,
                y: Math.random() * height,
                r: 1 + Math.random() * 2, // radius
                dx: -0.5 + Math.random(), // x movement
                dy: -0.5 + Math.random(), // y movement
                alpha: 0.1 + Math.random() * 0.3 // transparency
            });
        }

        // Animate the particles across the screen
        function animate() {
            ctx.clearRect(0, 0, width, height);
            for (let p of particles) {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
                ctx.fillStyle = `rgba(166, 136, 109, ${p.alpha})`;
                ctx.shadowColor = '#A6886D';
                ctx.shadowBlur = 8;
                ctx.fill();

                // Update position
                p.x += p.dx;
                p.y += p.dy;

                // Bounce off the walls
                if (p.x < 0 || p.x > width) p.dx *= -1;
                if (p.y < 0 || p.y > height) p.dy *= -1;
            }
            requestAnimationFrame(animate);
        }

        // Start the animation
        animate();

        // Update canvas size when window is resized
        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        });
    </script>
</body>
</html>
